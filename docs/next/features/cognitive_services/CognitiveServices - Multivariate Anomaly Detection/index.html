<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/SynapseML/blog/rss.xml" title="SynapseML RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/SynapseML/blog/atom.xml" title="SynapseML Atom Feed">
<link rel="alternate" type="application/json" href="/SynapseML/blog/feed.json" title="SynapseML JSON Feed">
<link rel="search" type="application/opensearchdescription+xml" title="SynapseML" href="/SynapseML/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">CognitiveServices - Multivariate Anomaly Detection | SynapseML</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://microsoft.github.io/SynapseML/img/synapseml_og.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://microsoft.github.io/SynapseML/img/synapseml_og.jpg"><meta data-react-helmet="true" property="og:url" content="https://microsoft.github.io/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Multivariate Anomaly Detection/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="CognitiveServices - Multivariate Anomaly Detection | SynapseML"><meta data-react-helmet="true" name="description" content="This recipe shows how you can use SynapseML and Azure Cognitive Services on Apache Spark for multivariate anomaly detection. Multivariate anomaly detection allows for the detection of anomalies among many variables or timeseries, taking into account all the inter-correlations and dependencies between the different variables. In this scenario, we use SynapseML to train a model for multivariate anomaly detection using the Azure Cognitive Services, and we then use to the model to infer multivariate anomalies within a dataset containing synthetic measurements from three IoT sensors."><meta data-react-helmet="true" property="og:description" content="This recipe shows how you can use SynapseML and Azure Cognitive Services on Apache Spark for multivariate anomaly detection. Multivariate anomaly detection allows for the detection of anomalies among many variables or timeseries, taking into account all the inter-correlations and dependencies between the different variables. In this scenario, we use SynapseML to train a model for multivariate anomaly detection using the Azure Cognitive Services, and we then use to the model to infer multivariate anomalies within a dataset containing synthetic measurements from three IoT sensors."><link data-react-helmet="true" rel="icon" href="/SynapseML/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://microsoft.github.io/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Multivariate Anomaly Detection/"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Multivariate Anomaly Detection/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Multivariate Anomaly Detection/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://GBW8AA15RD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/SynapseML/assets/css/styles.57389e66.css">
<link rel="preload" href="/SynapseML/assets/js/runtime~main.0b93e7b9.js" as="script">
<link rel="preload" href="/SynapseML/assets/js/main.be880b0c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">‚≠êÔ∏è If you like SynapseML, consider giving it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/Microsoft/SynapseML">GitHub</a> ‚≠ê</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/SynapseML/"><div class="navbar__logo"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/SynapseML/img/logo.svg" alt="SynapseML Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">SynapseML</b></a><a class="navbar__item navbar__link" href="/SynapseML/docs/about/">Docs</a><a class="navbar__item navbar__link" href="/SynapseML/blog/">Blog</a><a class="navbar__item navbar__link" href="/SynapseML/videos/">Videos</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/SynapseML/docs/next/about/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Multivariate Anomaly Detection/">Next</a></li><li><a class="dropdown__link" href="/SynapseML/docs/about/">0.9.5</a></li><li><a class="dropdown__link" href="/SynapseML/docs/0.9.4/about/">0.9.4</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Multivariate Anomaly Detection/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Developer Docs</a><ul class="dropdown__menu"><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.5/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Python<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://mmlspark.blob.core.windows.net/docs/0.9.5/scala/com/microsoft/azure/synapse/ml/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Scala<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_71bT toggle_3Zt9 toggleChecked_2FvV toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">üåú</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">üåû</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" checked="" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Kl_"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SynapseML/docs/next/about/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/SynapseML/docs/next/getting_started/installation/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Analyze Text/">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Analyze Text/">Cognitive Services</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Analyze Text/">CognitiveServices - Analyze Text</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Celebrity Quote Analysis/">CognitiveServices - Celebrity Quote Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Create a Multilingual Search Engine from Forms/">CognitiveServices - Create a Multilingual Search Engine from Forms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Multivariate Anomaly Detection/">CognitiveServices - Multivariate Anomaly Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Overview/">CognitiveServices - Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Predictive Maintenance/">CognitiveServices - Predictive Maintenance</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/geospatial_services/GeospatialServices - Flooding Risk/">Geospatial Services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/responsible_ai/Data Balance Analysis/">Responsible AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/onnx/ONNX - Inference on Spark/">ONNX</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/lightgbm/LightGBM - Overview/">LightGBM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/vw/Vowpal Wabbit - Overview/">Vowpal Wabbit</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/spark_serving/SparkServing - Deploying a Classifier/">Spark Serving</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/opencv/OpenCV - Pipeline Image Transformations/">OpenCV</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/classification/Classification - Adult Census with Vowpal Wabbit/">Classification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/regression/Regression - Auto Imports/">Regression</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/SynapseML/docs/next/features/other/AzureSearchIndex - Met Artworks/">Other</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/SynapseML/docs/next/documentation/transformers/transformers_cognitive/">Transformers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/SynapseML/docs/next/documentation/estimators/estimators_cognitive/">Estimators</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/SynapseML/docs/next/reference/developer-readme/">Reference</a></div></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->SynapseML<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/SynapseML/docs/about/">latest version</a></b> (<!-- -->0.9.5<!-- -->).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->Next</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Recipe: Cognitive Services - Multivariate Anomaly Detection</h1></header><p>This recipe shows how you can use SynapseML and Azure Cognitive Services on Apache Spark for multivariate anomaly detection. Multivariate anomaly detection allows for the detection of anomalies among many variables or timeseries, taking into account all the inter-correlations and dependencies between the different variables. In this scenario, we use SynapseML to train a model for multivariate anomaly detection using the Azure Cognitive Services, and we then use to the model to infer multivariate anomalies within a dataset containing synthetic measurements from three IoT sensors. </p><p>To learn more about the Anomaly Detector Cognitive Service please refer to <a href="https://docs.microsoft.com/en-us/azure/cognitive-services/anomaly-detector/" target="_blank" rel="noopener noreferrer"> this documentation page</a>. </p><h3 class="anchor anchorWithStickyNavbar_31ik" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">‚Äã</a></h3><ul><li>An Azure subscription - <a href="https://azure.microsoft.com/en-us/free/" target="_blank" rel="noopener noreferrer">Create one for free</a></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="setup">Setup<a class="hash-link" href="#setup" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="create-an-anomaly-detector-resource">Create an Anomaly Detector resource<a class="hash-link" href="#create-an-anomaly-detector-resource" title="Direct link to heading">‚Äã</a></h4><p>Follow the instructions below to create an <code>Anomaly Detector</code> resource using the Azure portal or alternatively, you can also use the Azure CLI to create this resource.</p><ul><li>In the Azure Portal, click <code>Create</code> in your resource group, and then type <code>Anomaly Detector</code>. Click on the Anomaly Detector resource.</li><li>Give the resource a name, and ideally use the same region as the rest of your resource group. Use the default options for the rest, and then click <code>Review + Create</code> and then <code>Create</code>.</li><li>Once the Anomaly Detector resource is created, open it and click on the <code>Keys and Endpoints</code> panel on the left. Copy the key for the Anomaly Detector resource into the <code>ANOMALY_API_KEY</code> environment variable, or store it in the <code>anomalyKey</code> variable in the cell below.</li></ul><h4 class="anchor anchorWithStickyNavbar_31ik" id="create-a-storage-account-resource">Create a Storage Account resource<a class="hash-link" href="#create-a-storage-account-resource" title="Direct link to heading">‚Äã</a></h4><p>In order to save intermediate data, you will need to create an Azure Blob Storage Account. Within that storage account, create a container for storing the intermediate data. Make note of the container name, and copy the connection string to that container. You will need this later to populate the <code>containerName</code> variable and the <code>BLOB_CONNECTION_STRING</code> environment variable.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="enter-your-service-keys">Enter your service keys<a class="hash-link" href="#enter-your-service-keys" title="Direct link to heading">‚Äã</a></h4><p>Let&#x27;s start by setting up the environment variables for our service keys. The next cell sets the <code>ANOMALY_API_KEY</code> and the <code>BLOB_CONNECTION_STRING</code> environment variables based on the values stored in our Azure Key Vault. If you are running this in your own environment, make sure you set these environment variables before you proceed.</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;AZURE_SERVICE&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Microsoft.ProjectArcadia&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">sql </span><span class="token keyword">import</span><span class="token plain"> SparkSession</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    spark </span><span class="token operator">=</span><span class="token plain"> SparkSession</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">builder</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">getOrCreate</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">from</span><span class="token plain"> notebookutils</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">mssparkutils</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">credentials </span><span class="token keyword">import</span><span class="token plain"> getSecret</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;ANOMALY_API_KEY&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> getSecret</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;mmlspark-keys&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;anomaly-api-key&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;BLOB_CONNECTION_STRING&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> getSecret</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;mmlspark-keys&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;madtest-connection-string&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="ansiout"></div><p>Now, lets read the <code>ANOMALY_API_KEY</code> and <code>BLOB_CONNECTION_STRING</code> environment variables and set the <code>containerName</code> and <code>location</code> variables.</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:rgb(136, 132, 111)"># An Anomaly Dectector subscription key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">anomalyKey </span><span class="token operator">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;ANOMALY_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># A connection string to your blob storage account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">connectionString </span><span class="token operator">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;BLOB_CONNECTION_STRING&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># The name of the container where you will store intermediate data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">containerName </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;intermediate-data-container-name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># The location of the anomaly detector resource that you created</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">location </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;westus2&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="ansiout"></div><p>Let&#x27;s import all the necessary modules.</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">import</span><span class="token plain"> numpy </span><span class="token keyword">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> pandas </span><span class="token keyword">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> pyspark</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">functions </span><span class="token keyword">import</span><span class="token plain"> col</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">functions </span><span class="token keyword">import</span><span class="token plain"> lit</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">types </span><span class="token keyword">import</span><span class="token plain"> DoubleType</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">pyplot </span><span class="token keyword">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> synapse</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> synapse</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ml</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">cognitive </span><span class="token keyword">import</span><span class="token plain"> </span><span class="token operator">*</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="ansiout"></div><p>Now, let&#x27;s read our sample data into a Spark DataFrame.</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">df </span><span class="token operator">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token builtin" style="color:rgb(174, 129, 255)">format</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;csv&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">option</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;header&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;wasbs://publicwasb@mmlspark.blob.core.windows.net/MVAD/sample.csv&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">df </span><span class="token operator">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_1&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> col</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_1&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">DoubleType</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_2&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> col</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_2&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">DoubleType</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_3&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> col</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_3&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">DoubleType</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)"># Let&#x27;s inspect the dataframe:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">df</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">5</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can now create an <code>estimator</code> object, which will be used to train our model. In the cell below, we specify the start and end times for the training data. We also specify the input columns to use, and the name of the column that contains the timestamps. Finally, we specify the number of data points to use in the anomaly detection sliding window, and we set the connection string to the Azure Blob Storage Account. </p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">trainingStartTime </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;2020-06-01T12:00:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">trainingEndTime </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;2020-07-02T17:55:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">intermediateSaveDir </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;intermediateData&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">timestampColumn </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;timestamp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">inputColumns </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_1&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_2&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;sensor_3&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">estimator </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">FitMultivariateAnomaly</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setSubscriptionKey</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">anomalyKey</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setLocation</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setStartTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">trainingStartTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setEndTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">trainingEndTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setContainerName</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">containerName</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setIntermediateSaveDir</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">intermediateSaveDir</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setTimestampCol</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">timestampColumn</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setInputCols</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">inputColumns</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setSlidingWindow</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">200</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setConnectionString</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">connectionString</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="ansiout"></div><p>Now that we have created the <code>estimator</code>, let&#x27;s fit it to the data:</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">model </span><span class="token operator">=</span><span class="token plain"> estimator</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="ansiout"></div><p>Once the training is done, we can now use the model for inference. The code in the next cell specifies the start and end times for the data we would like to detect the anomlies in. It will then show the results.</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">inferenceStartTime </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;2020-07-02T18:00:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">inferenceEndTime </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;2020-07-06T05:15:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">model</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setStartTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">inferenceStartTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setEndTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">inferenceEndTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setOutputCol</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;results&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setErrorCol</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;errors&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setInputCols</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">inputColumns</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">setTimestampCol</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">timestampColumn</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">result</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">5</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When we called <code>.show(5)</code> in the previous cell, it showed us the first five rows in the dataframe. The results were all <code>null</code> because they were not inside the inferrence window.</p><p>To show the results only for the infferred data, lets select the columns we need. We can then order the rows in the dataframe by ascending order, and filter the result to only show the rows that are in the range of the inference window. In our case <code>inferenceEndTime</code> is the same as the last row in the dataframe, so can ignore that. </p><p>Finally, to be able to better plot the results, lets convert the Spark dataframe to a Pandas dataframe.</p><p>This is what the next cell does:</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">rdf </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">select</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;timestamp&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token operator">*</span><span class="token plain">inputColumns</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;results.contributors&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;results.isAnomaly&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&quot;results.severity&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">orderBy</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> ascending</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token builtin" style="color:rgb(174, 129, 255)">filter</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">col</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> </span><span class="token operator">&gt;=</span><span class="token plain"> lit</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">inferenceStartTime</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">toPandas</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">rdf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="ansiout">/databricks/spark/python/pyspark/sql/pandas/conversion.py:92: UserWarning: toPandas attempted Arrow optimization because &#x27;spark.sql.execution.arrow.pyspark.enabled&#x27; is set to true; however, failed by the reason below: Unable to convert the field contributors. If this column is not necessary, you may consider dropping it or converting to primitive type before the conversion. Direct cause: Unsupported type in conversion to Arrow: ArrayType(StructType(List(StructField(contributionScore,DoubleType,true),StructField(variable,StringType,true))),true) Attempting non-optimization as &#x27;spark.sql.execution.arrow.pyspark.fallback.enabled&#x27; is set to true. warnings.warn(msg) Out[8]: </div><div><table border="1" class="dataframe"><thead><tr><th></th><th>timestamp</th><th>sensor_1</th><th>sensor_2</th><th>sensor_3</th><th>contributors</th><th>isAnomaly</th><th>severity</th></tr></thead><tbody><tr><th>0</th><td>2020-07-02T18:00:00Z</td><td>1.069680</td><td>0.393173</td><td>3.129125</td><td>None</td><td>False</td><td>0.00000</td></tr><tr><th>1</th><td>2020-07-02T18:05:00Z</td><td>0.932784</td><td>0.214959</td><td>3.077339</td><td>[(0.5516611337661743, series_1), (0.3133429884...</td><td>True</td><td>0.06478</td></tr><tr><th>2</th><td>2020-07-02T18:10:00Z</td><td>1.012214</td><td>0.466037</td><td>2.909561</td><td>None</td><td>False</td><td>0.00000</td></tr><tr><th>3</th><td>2020-07-02T18:15:00Z</td><td>1.122182</td><td>0.398438</td><td>3.029489</td><td>None</td><td>False</td><td>0.00000</td></tr><tr><th>4</th><td>2020-07-02T18:20:00Z</td><td>1.091310</td><td>0.282137</td><td>2.948016</td><td>None</td><td>False</td><td>0.00000</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>995</th><td>2020-07-06T04:55:00Z</td><td>-0.443438</td><td>0.768980</td><td>-0.710800</td><td>None</td><td>False</td><td>0.00000</td></tr><tr><th>996</th><td>2020-07-06T05:00:00Z</td><td>-0.529400</td><td>0.822140</td><td>-0.944681</td><td>None</td><td>False</td><td>0.00000</td></tr><tr><th>997</th><td>2020-07-06T05:05:00Z</td><td>-0.377911</td><td>0.738591</td><td>-0.871468</td><td>None</td><td>False</td><td>0.00000</td></tr><tr><th>998</th><td>2020-07-06T05:10:00Z</td><td>-0.501993</td><td>0.727775</td><td>-0.786263</td><td>None</td><td>False</td><td>0.00000</td></tr><tr><th>999</th><td>2020-07-06T05:15:00Z</td><td>-0.404138</td><td>0.806980</td><td>-0.883521</td><td>None</td><td>False</td><td>0.00000</td></tr></tbody></table><p>1000 rows √ó 7 columns</p></div><p>Let&#x27;s now format the <code>contributors</code> column that stores the contribution score from each sensor to the detected anomalies. The next cell formats this data, and splits the contribution score of each sensor into its own column.</p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token keyword">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(166, 226, 46)">parse</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(174, 129, 255)">type</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"> </span><span class="token keyword">is</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(174, 129, 255)">list</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(174, 129, 255)">dict</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token plain">item</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token operator">-</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> item </span><span class="token keyword">in</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword">else</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(249, 38, 114)">{</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_0&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_1&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_2&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;contributors&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;contributors&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token builtin" style="color:rgb(174, 129, 255)">apply</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">parse</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">rdf </span><span class="token operator">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;contributors&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> axis</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> pd</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">json_normalize</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;contributors&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> axis</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">rdf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="ansiout">Out[9]: </div><div><table border="1" class="dataframe"><thead><tr><th></th><th>timestamp</th><th>sensor_1</th><th>sensor_2</th><th>sensor_3</th><th>isAnomaly</th><th>severity</th><th>series_0</th><th>series_1</th><th>series_2</th></tr></thead><tbody><tr><th>0</th><td>2020-07-02T18:00:00Z</td><td>1.069680</td><td>0.393173</td><td>3.129125</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>1</th><td>2020-07-02T18:05:00Z</td><td>0.932784</td><td>0.214959</td><td>3.077339</td><td>True</td><td>0.06478</td><td>0.313343</td><td>0.551661</td><td>0.134996</td></tr><tr><th>2</th><td>2020-07-02T18:10:00Z</td><td>1.012214</td><td>0.466037</td><td>2.909561</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>3</th><td>2020-07-02T18:15:00Z</td><td>1.122182</td><td>0.398438</td><td>3.029489</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>4</th><td>2020-07-02T18:20:00Z</td><td>1.091310</td><td>0.282137</td><td>2.948016</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>995</th><td>2020-07-06T04:55:00Z</td><td>-0.443438</td><td>0.768980</td><td>-0.710800</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>996</th><td>2020-07-06T05:00:00Z</td><td>-0.529400</td><td>0.822140</td><td>-0.944681</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>997</th><td>2020-07-06T05:05:00Z</td><td>-0.377911</td><td>0.738591</td><td>-0.871468</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>998</th><td>2020-07-06T05:10:00Z</td><td>-0.501993</td><td>0.727775</td><td>-0.786263</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>999</th><td>2020-07-06T05:15:00Z</td><td>-0.404138</td><td>0.806980</td><td>-0.883521</td><td>False</td><td>0.00000</td><td>0.000000</td><td>0.000000</td><td>0.000000</td></tr></tbody></table><p>1000 rows √ó 9 columns</p></div><p>Great! We now have the contribution scores of sensors 1, 2, and 3 in the <code>series_0</code>, <code>series_1</code>, and <code>series_2</code> columns respectively. </p><p>Let&#x27;s run the next cell to plot the results. The <code>minSeverity</code> parameter in the first line specifies the minimum severity of the anomalies to be plotted. </p><div class="codeBlockContainer_K1bP language-python theme-code-block"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#f8f8f2"><span class="token plain">minSeverity </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(174, 129, 255)">0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)">####### Main Figure #######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">figsize</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">23</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token number" style="color:rgb(174, 129, 255)">8</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_1&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;tab:orange&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linestyle</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;solid&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linewidth</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">2</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_1&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_2&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;tab:green&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linestyle</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;solid&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linewidth</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">2</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_2&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_3&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;tab:blue&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linestyle</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;solid&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linewidth</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">2</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_3&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">grid</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">axis</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;y&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">tick_params</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">axis</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;x&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">which</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;both&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">bottom</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">labelbottom</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">anoms </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(174, 129, 255)">list</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;severity&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token plain"> </span><span class="token operator">&gt;=</span><span class="token plain"> minSeverity</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> ymin</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> ymax </span><span class="token operator">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">axis</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">vlines</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">where</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">anoms</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> ymin</span><span class="token operator">=</span><span class="token plain">ymin </span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> ymax</span><span class="token operator">=</span><span class="token plain">ymax </span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;r&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> alpha</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">0.8</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;A plot of the values from the three sensors with the detected anomalies highlighted in red.&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)">####### Severity Figure #######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">figsize</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">23</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">tick_params</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">axis</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;x&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">which</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;both&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">bottom</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">labelbottom</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;severity&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;black&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linestyle</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;solid&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linewidth</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">2</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;Severity score&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token plain">minSeverity</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token operator">*</span><span class="token builtin" style="color:rgb(174, 129, 255)">len</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;severity&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;red&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linestyle</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;dotted&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> linewidth</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;minSeverity&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">grid</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">axis</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;y&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ylim</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;Severity of the detected anomalies&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:rgb(136, 132, 111)">####### Contributors Figure #######</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">figsize</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token number" style="color:rgb(174, 129, 255)">23</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">tick_params</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">axis</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;x&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">which</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;both&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">bottom</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">labelbottom</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">bar</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_0&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> width</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">2</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;tab:orange&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_1&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">bar</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_1&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> width</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">2</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;tab:green&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_2&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> bottom</span><span class="token operator">=</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_0&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">bar</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_2&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> width</span><span class="token operator">=</span><span class="token number" style="color:rgb(174, 129, 255)">2</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> color</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;tab:blue&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;sensor_3&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token plain"> bottom</span><span class="token operator">=</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_0&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token operator">+</span><span class="token plain">rdf</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;series_1&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">grid</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token plain">axis</span><span class="token operator">=</span><span class="token string" style="color:rgb(230, 219, 116)">&#x27;y&#x27;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">ylim</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">[</span><span class="token number" style="color:rgb(174, 129, 255)">0</span><span class="token punctuation" style="color:rgb(249, 38, 114)">,</span><span class="token number" style="color:rgb(174, 129, 255)">1</span><span class="token punctuation" style="color:rgb(249, 38, 114)">]</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token string" style="color:rgb(230, 219, 116)">&quot;The contribution of each sensor to the detected anomaly&quot;</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">plt</span><span class="token punctuation" style="color:rgb(249, 38, 114)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(249, 38, 114)">(</span><span class="token punctuation" style="color:rgb(249, 38, 114)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><img width="1300" src="https://mmlspark.blob.core.windows.net/graphics/mvad_plot.png"><p>The plots above show the raw data from the sensors (inside the inference window) in orange, green, and blue. The red vertical lines in the first figure show the detected anomalies that have a severity greater than or equal to <code>minSeverity</code>. </p><p>The second plot shows the severity score of all the detected anomalies, with the <code>minSeverity</code> threshold shown in the dotted red line.</p><p>Finally, the last plot shows the contribution of the data from each sensor to the detected anomalies. This helps us diagnose and understand the most likely cause of each anomaly.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Create a Multilingual Search Engine from Forms/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CognitiveServices - Create a Multilingual Search Engine from Forms</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/SynapseML/docs/next/features/cognitive_services/CognitiveServices - Overview/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CognitiveServices - Overview</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/installation/">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/docs/getting_started/first_example/">Getting Started</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.5/pyspark/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python API Reference</a></li><li class="footer__item"><a href="https://mmlspark.blob.core.windows.net/docs/0.9.5/scala/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scala API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SynapseML/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/SynapseML/videos/">Videos</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/microsoft/SynapseML" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Microsoft.</div></div></div></footer></div>
<script src="/SynapseML/assets/js/runtime~main.0b93e7b9.js"></script>
<script src="/SynapseML/assets/js/main.be880b0c.js"></script>
</body>
</html>